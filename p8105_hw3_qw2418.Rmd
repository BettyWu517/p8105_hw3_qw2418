---
title: "p8105_hw3"
author: "Qianying Wu"
date: "2023-10-12"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)
```

## Problem 1

```{r}
library(p8105.datasets)
data("instacart")
```


## Problem 2

### Data cleaning

* format the data to use appropriate variable names;
* focus on the “Overall Health” topic
* include only responses from “Excellent” to “Poor”
* organize responses as a factor taking levels ordered from “Poor” to “Excellent”

```{r}

library(p8105.datasets)
data("brfss_smart2010")
brfss = brfss_smart2010 |> 
  janitor::clean_names() |>
  filter(topic == "Overall Health", response == "Excellent" | response == "Poor") |>
  mutate(forcats::fct_relevel(response, "Poor", "Excellent")) |> 
  rename(state = locationabbr, county = locationdesc)
head(brfss)
```


1. In 2002, which states were observed at 7 or more locations? What about in 2010?

```{r}
state_2002 <- brfss |> filter(year == "2002") 


state_2002_7 = state_2002 |> 
  group_by(state) |>
  count(state, name = "n_obs") |>
  filter(n_obs >= 7) 

state_2002_7

state_2010 <- brfss |> filter(year == "2010") 


state_2010_7 = state_2010 |> 
  group_by(state) |>
  count(state, name = "n_obs") |>
  filter(n_obs >= 7) 

state_2010_7
```

- According to the result, we know that in 2002, the states CO, CT, FL, HI, MA, MD, MI, MN, NC, NH, NJ, NY, OH, PA, RI, UT, and WA were observed at 7 or more locations. 

- In 2010, the states "CA" "CO" "CT" "FL" "GA" "HI" "ID" "KS" "LA" "MA" "MD" "ME" "MI" "MN" "NC" "NE" "NH" "NJ" "NM" "NY" "OH" "OR" "PA" "RI" "SC" "TN" "TX" "UT" "VT" "WA" were observed at 7 or more locations. 


2. Construct a dataset that is limited to Excellent responses, and contains, year, state, and a variable that averages the data_value across locations within a state. Make a “spaghetti” plot of this average value over time within a state (that is, make a plot showing a line for each state across years – the geom_line geometry and group aesthetic will help).

```{r}

excellent_data <- brfss |>
  filter(response == "Excellent") |>
  select(year, state, data_value)

# Calculate the average data value within each state for each year
average_data_by_state <- excellent_data |>
  group_by(year, state) |>
  summarise(average = mean(data_value))

average_data_by_state
# Create a "spaghetti" plot
ggplot(average_data_by_state, aes(x = year, y = average, group = state, color = state)) +
  geom_line() +
  labs(
    x = "Year",
    y = "Average Data Value",
    title = "Average Data Value Accross Year In Different States"
  )


```
